<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Services - é€šç”¨HTTPå®¢æˆ·ç«¯</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section {
            background: white;
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .button {
            background: #6C5CE7;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background: #5a4fcf;
        }
        .button.success {
            background: #00b894;
        }
        .button.info {
            background: #0984e3;
        }
        .result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-top: 10px;
            max-height: 400px;
            overflow-y: auto;
        }
        pre {
            margin: 0;
            white-space: pre-wrap;
        }
        .code {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸŒ é€šç”¨HTTPå®¢æˆ·ç«¯æœåŠ¡</h1>
        <p>ç°ä»£åŒ–çš„HTTPå®¢æˆ·ç«¯æœåŠ¡ï¼Œä¸“æ³¨äºæä¾›HTTPè¯·æ±‚èƒ½åŠ›</p>
        <p><strong>ç«¯å£: 9101</strong> | <strong>ä¸åŒ…å«ä¸šåŠ¡é€»è¾‘ï¼Œç”±è°ƒç”¨æ–¹å®šä¹‰APIç«¯ç‚¹</strong></p>
    </div>

    <div class="section">
        <h3>ğŸ“š ä½¿ç”¨è¯´æ˜</h3>
        <p>API-servicesç°åœ¨æ˜¯ä¸€ä¸ªçº¯ç²¹çš„HTTPå®¢æˆ·ç«¯æœåŠ¡ï¼Œä¸åŒ…å«å…·ä½“çš„ä¸šåŠ¡APIã€‚ä¸šåŠ¡é€»è¾‘åº”è¯¥åœ¨è°ƒç”¨æ–¹ï¼ˆå¦‚homeåº”ç”¨ï¼‰ä¸­å®šä¹‰ã€‚</p>
        
        <div class="code">// æ¨èæ–¹å¼ï¼šä½¿ç”¨ä¾¿æ·çš„å®¢æˆ·ç«¯å·¥å‚
const gameClient = await window.$api.createClient('game', {
  baseURL: '/api/games',
  timeout: 5000
})

// å‘èµ·è¯·æ±‚ï¼ˆå…·ä½“ç«¯ç‚¹ç”±è°ƒç”¨æ–¹å®šä¹‰ï¼‰
const games = await gameClient.get('/featured?limit=4')

// æˆ–è€…é«˜çº§æ–¹å¼ï¼šç›´æ¥ä½¿ç”¨HTTPæœåŠ¡
const httpService = window.$api.getHttpService()
const customClient = httpService.createClient('custom', { ... })</div>
    </div>

    <div class="section">
        <h3>ğŸ”§ HTTPå®¢æˆ·ç«¯åŠŸèƒ½æµ‹è¯•</h3>
        <button class="button" onclick="testBasicHTTP()">æµ‹è¯•åŸºæœ¬HTTPè¯·æ±‚</button>
        <button class="button success" onclick="testClientManagement()">æµ‹è¯•å®¢æˆ·ç«¯ç®¡ç†</button>
        <button class="button info" onclick="testAuthFeatures()">æµ‹è¯•è®¤è¯åŠŸèƒ½</button>
        <button class="button" onclick="testCacheFeatures()">æµ‹è¯•ç¼“å­˜åŠŸèƒ½</button>
        <div id="httpResult" class="result" style="display: none;">
            <pre id="httpResultContent"></pre>
        </div>
    </div>

    <div class="section">
        <h3>ğŸ“Š æœåŠ¡çŠ¶æ€</h3>
        <button class="button" onclick="testHealthCheck()">å¥åº·æ£€æŸ¥</button>
        <button class="button" onclick="clearAllCache()">æ¸…ç©ºç¼“å­˜</button>
        <div id="status">åˆå§‹åŒ–ä¸­...</div>
    </div>

    <div class="section">
        <h3>ğŸ’¡ è°ƒç”¨æ–¹ç¤ºä¾‹</h3>
        <p>ä»¥ä¸‹æ˜¯åœ¨ä¸åŒå¾®åº”ç”¨ä¸­å¦‚ä½•ä½¿ç”¨è¿™ä¸ªHTTPå®¢æˆ·ç«¯æœåŠ¡çš„ç¤ºä¾‹ï¼š</p>
        
        <h4>1. æ¸¸æˆAPIç¤ºä¾‹ï¼ˆhomeåº”ç”¨ä¸“ç”¨ï¼‰</h4>
        <div class="code">// gameApi.js - è¶…ç®€æ´çš„åˆå§‹åŒ–
class GameApi {
  constructor() {
    // ç›´æ¥åœ¨æ„é€ å‡½æ•°ä¸­åˆ›å»ºå®¢æˆ·ç«¯Promise
    this._clientPromise = window.$api.createClient('game', {
      baseURL: '/api/games',
      timeout: 8000
    })
  }

  async getFeaturedGames(options = {}) {
    const client = await this._clientPromise
    const params = new URLSearchParams(options).toString()
    return client.get(`/featured?${params}`)
  }

  async getGameDetail(gameId) {
    const client = await this._clientPromise
    return client.get(`/${gameId}`)
  }
}

export default new GameApi()</div>

        <h4>2. æ”¯ä»˜æœåŠ¡ç¤ºä¾‹ï¼ˆåœ¨å…¶ä»–å¾®åº”ç”¨ä¸­ï¼‰</h4>
        <div class="code">// paymentApi.js - åŒæ ·ç®€æ´
class PaymentApi {
  constructor() {
    // ç›´æ¥åœ¨æ„é€ å‡½æ•°ä¸­åˆ›å»ºå®¢æˆ·ç«¯Promise
    this._clientPromise = window.$api.createClient('payment', {
      baseURL: '/api/payments',
      headers: { 'X-Service': 'payment' }
    })
  }

  async processPayment(amount, method) {
    const client = await this._clientPromise
    return client.post('/process', { amount, method })
  }

  async getPaymentHistory() {
    const client = await this._clientPromise
    return client.get('/history')
  }
}

export default new PaymentApi()</div>
    </div>

    <script type="module">
        import { httpApi, serviceManager } from '/src/services.js'

        // å·¥å…·å‡½æ•°
        function showHttpResult(content) {
            const resultDiv = document.getElementById('httpResult')
            const contentDiv = document.getElementById('httpResultContent')
            resultDiv.style.display = 'block'
            contentDiv.textContent = content
        }

        // æµ‹è¯•å‡½æ•°
        window.testFunctions = {
            async testBasicHTTP() {
                showHttpResult('æ­£åœ¨æµ‹è¯•åŸºæœ¬HTTPè¯·æ±‚åŠŸèƒ½...')
                try {
                    const httpService = await httpApi.getHttpService()
                    
                    // æµ‹è¯•åŸºæœ¬è¯·æ±‚æ–¹æ³•
                    const results = {
                        service: 'HttpService',
                        availableMethods: ['GET', 'POST', 'PUT', 'PATCH', 'DELETE', 'HEAD', 'UPLOAD'],
                        defaultClient: {
                            timeout: httpService.defaultClient.config.timeout,
                            retry: httpService.defaultClient.config.retry,
                            headers: httpService.defaultClient.config.headers
                        },
                        features: [
                            'âœ… å¤šå®¢æˆ·ç«¯ç®¡ç†',
                            'âœ… è‡ªåŠ¨é‡è¯•æœºåˆ¶', 
                            'âœ… è¯·æ±‚/å“åº”æ‹¦æˆªå™¨',
                            'âœ… ç¼“å­˜ç®¡ç†',
                            'âœ… è®¤è¯ä»¤ç‰Œç®¡ç†',
                            'âœ… æ–‡ä»¶ä¸Šä¼ æ”¯æŒ'
                        ],
                        usage: 'ç”±è°ƒç”¨æ–¹å®šä¹‰å…·ä½“APIç«¯ç‚¹å’Œä¸šåŠ¡é€»è¾‘'
                    }
                    
                    showHttpResult(JSON.stringify(results, null, 2))
                } catch (error) {
                    showHttpResult(`é”™è¯¯: ${error.message}`)
                }
            },

            async testClientManagement() {
                showHttpResult('æ­£åœ¨æµ‹è¯•HTTPå®¢æˆ·ç«¯ç®¡ç†...')
                try {
                    const httpService = await httpApi.getHttpService()
                    
                    // åˆ›å»ºå¤šä¸ªå®¢æˆ·ç«¯
                    const gameClient = httpService.createClient('game', {
                        baseURL: '/api/games',
                        timeout: 5000,
                        headers: { 'X-Service': 'game' }
                    })
                    
                    const userClient = httpService.createClient('user', {
                        baseURL: '/api/users', 
                        timeout: 8000,
                        retry: 2
                    })
                    
                    const results = {
                        clientManagement: {
                            createdClients: httpService.listClients(),
                            gameClient: {
                                name: 'game',
                                baseURL: '/api/games',
                                timeout: 5000
                            },
                            userClient: {
                                name: 'user',
                                baseURL: '/api/users',
                                timeout: 8000
                            }
                        },
                        benefits: [
                            'ä¸åŒæœåŠ¡ä½¿ç”¨ä¸åŒé…ç½®',
                            'ç‹¬ç«‹çš„è®¤è¯å’Œç¼“å­˜',
                            'çµæ´»çš„è¶…æ—¶å’Œé‡è¯•è®¾ç½®',
                            'ä¾¿äºæœåŠ¡éš”ç¦»å’Œç®¡ç†'
                        ]
                    }
                    
                    showHttpResult(JSON.stringify(results, null, 2))
                } catch (error) {
                    showHttpResult(`é”™è¯¯: ${error.message}`)
                }
            },

            async testAuthFeatures() {
                showHttpResult('æ­£åœ¨æµ‹è¯•è®¤è¯åŠŸèƒ½...')
                try {
                    const httpService = await httpApi.getHttpService()
                    
                    // åˆ›å»ºç”¨æˆ·å®¢æˆ·ç«¯
                    const userClient = httpService.createClient('auth-test', {
                        baseURL: '/api/auth'
                    })
                    
                    // è®¾ç½®è®¤è¯ä»¤ç‰Œ
                    const testToken = 'mock_jwt_token_12345'
                    httpService.setAuthToken(testToken, 'auth-test')
                    
                    const results = {
                        authentication: {
                            method: 'Bearer Token',
                            tokenSet: true,
                            autoAttachment: 'è‡ªåŠ¨æ·»åŠ åˆ°è¯·æ±‚å¤´',
                            clientSpecific: 'å¯ä¸ºä¸åŒå®¢æˆ·ç«¯è®¾ç½®ä¸åŒä»¤ç‰Œ'
                        },
                        features: [
                            'å…¨å±€ä»¤ç‰Œç®¡ç†',
                            'å®¢æˆ·ç«¯çº§ä»¤ç‰Œç®¡ç†', 
                            'è‡ªåŠ¨è¯·æ±‚å¤´æ³¨å…¥',
                            'ä»¤ç‰Œæ¸…é™¤åŠŸèƒ½'
                        ],
                        example: {
                            setGlobalToken: "httpService.setAuthToken('token')",
                            setClientToken: "httpService.setAuthToken('token', 'clientName')",
                            clearToken: "httpService.clearAuthToken('clientName')"
                        }
                    }
                    
                    showHttpResult(JSON.stringify(results, null, 2))
                } catch (error) {
                    showHttpResult(`é”™è¯¯: ${error.message}`)
                }
            },

            async testCacheFeatures() {
                showHttpResult('æ­£åœ¨æµ‹è¯•ç¼“å­˜åŠŸèƒ½...')
                try {
                    const httpService = await httpApi.getHttpService()
                    
                    const results = {
                        caching: {
                            type: 'å†…å­˜ç¼“å­˜',
                            ttl: '5åˆ†é’Ÿ',
                            keyGeneration: 'URL + å‚æ•°å“ˆå¸Œ',
                            scope: 'æ¯ä¸ªHTTPå®¢æˆ·ç«¯ç‹¬ç«‹ç¼“å­˜'
                        },
                        methods: {
                            clearAllCache: 'httpService.clearAllCache()',
                            clearClientCache: 'client.clearCache()',
                            useCache: "client.get('/data', { useCache: true })"
                        },
                        benefits: [
                            'å‡å°‘ç½‘ç»œè¯·æ±‚',
                            'æå‡å“åº”é€Ÿåº¦',  
                            'é™ä½æœåŠ¡å™¨è´Ÿè½½',
                            'æ”¹å–„ç”¨æˆ·ä½“éªŒ'
                        ]
                    }
                    
                    // æ¸…ç©ºæ‰€æœ‰ç¼“å­˜ä½œä¸ºæ¼”ç¤º
                    httpService.clearAllCache()
                    
                    showHttpResult(JSON.stringify(results, null, 2))
                } catch (error) {
                    showHttpResult(`é”™è¯¯: ${error.message}`)
                }
            },

            async testHealthCheck() {
                showHttpResult('æ­£åœ¨è¿›è¡Œå¥åº·æ£€æŸ¥...')
                try {
                    const result = await serviceManager.getHealthStatus()
                    showHttpResult(JSON.stringify(result, null, 2))
                } catch (error) {
                    showHttpResult(`é”™è¯¯: ${error.message}`)
                }
            },

            async clearAllCache() {
                try {
                    await serviceManager.clearAllCache()
                    document.getElementById('status').innerHTML = `
                        <div style="color: green;">âœ… æ‰€æœ‰ç¼“å­˜å·²æ¸…ç©º</div>
                        <div>æ¸…ç©ºæ—¶é—´: ${new Date().toLocaleString()}</div>
                    `
                } catch (error) {
                    document.getElementById('status').innerHTML = `
                        <div style="color: red;">âŒ æ¸…ç©ºç¼“å­˜å¤±è´¥: ${error.message}</div>
                    `
                }
            }
        }

        // ç»‘å®šåˆ°å…¨å±€
        Object.assign(window, window.testFunctions)

        // åˆå§‹åŒ–æœåŠ¡å¹¶æ›´æ–°çŠ¶æ€
        async function initServices() {
            try {
                await serviceManager.init()
                document.getElementById('status').innerHTML = `
                    <div style="color: green; margin-bottom: 10px;">âœ… HTTPå®¢æˆ·ç«¯æœåŠ¡åˆå§‹åŒ–å®Œæˆ</div>
                    <div><strong>å·²æ³¨å†ŒæœåŠ¡:</strong> ${serviceManager.getServiceNames().join(', ')}</div>
                    <div><strong>æœåŠ¡ç±»å‹:</strong> é€šç”¨HTTPå®¢æˆ·ç«¯ï¼ˆä¸åŒ…å«ä¸šåŠ¡é€»è¾‘ï¼‰</div>
                    <div><strong>åˆå§‹åŒ–æ—¶é—´:</strong> ${new Date().toLocaleString()}</div>
                `
            } catch (error) {
                document.getElementById('status').innerHTML = `
                    <div style="color: red;">âŒ åˆå§‹åŒ–å¤±è´¥: ${error.message}</div>
                `
            }
        }

        initServices()
    </script>
</body>
</html>